<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯­éŸ³è¯†åˆ«æ­Œè¯ç”Ÿæˆæ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
        }
        .button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .button:hover {
            background: #2563eb;
        }
        .button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
        }
        .status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        .status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        .status.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .lyrics-output {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #3b82f6;
        }
        .stat-label {
            font-size: 14px;
            color: #64748b;
            margin-top: 5px;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        .warning {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            color: #92400e;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤ è¯­éŸ³è¯†åˆ«æ­Œè¯ç”Ÿæˆæ¼”ç¤º</h1>
            <p>åŸºäºWeb Speech APIçš„æ™ºèƒ½æ­Œè¯è¯†åˆ«ç³»ç»Ÿ</p>
        </div>

        <div class="warning">
            <strong>âš ï¸ ä½¿ç”¨è¯´æ˜ï¼š</strong>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>éœ€è¦Chromeæˆ–Edgeæµè§ˆå™¨</li>
                <li>éœ€è¦å…è®¸éº¦å…‹é£æƒé™</li>
                <li>å»ºè®®åœ¨å®‰é™ç¯å¢ƒä¸­æµ‹è¯•</li>
                <li>å¯ä»¥æ’­æ”¾ä»»æ„éŸ³é¢‘è¿›è¡Œè¯†åˆ«</li>
            </ul>
        </div>

        <div class="demo-section">
            <h3>ğŸµ è¯­éŸ³è¯†åˆ«æµ‹è¯•</h3>
            <p>ç‚¹å‡»æŒ‰é’®å¼€å§‹è¯­éŸ³è¯†åˆ«ï¼Œç„¶åè¯´è¯æˆ–æ’­æ”¾éŸ³é¢‘</p>
            
            <button id="startBtn" class="button">ğŸ¤ å¼€å§‹è¯†åˆ«</button>
            <button id="stopBtn" class="button" disabled>â¹ï¸ åœæ­¢è¯†åˆ«</button>
            <button id="clearBtn" class="button">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
            
            <div id="status" class="status" style="display: none;"></div>
            
            <div class="progress-bar" id="progressBar" style="display: none;">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="stats" id="stats" style="display: none;">
            <div class="stat-item">
                <div class="stat-value" id="segmentCount">0</div>
                <div class="stat-label">è¯†åˆ«æ®µè½</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="wordCount">0</div>
                <div class="stat-label">æ€»å­—æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="confidence">0%</div>
                <div class="stat-label">å¹³å‡ç½®ä¿¡åº¦</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="duration">0s</div>
                <div class="stat-label">è¯†åˆ«æ—¶é•¿</div>
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸ“ è¯†åˆ«ç»“æœ</h3>
            <div id="lyricsOutput" class="lyrics-output" style="display: none;"></div>
            <button id="downloadBtn" class="button" style="display: none;">ğŸ’¾ ä¸‹è½½LRCæ–‡ä»¶</button>
        </div>

        <div class="demo-section">
            <h3>ğŸ”§ åŠŸèƒ½ç‰¹æ€§</h3>
            <ul style="text-align: left; max-width: 600px; margin: 0 auto;">
                <li><strong>å®æ—¶è¯†åˆ«</strong>ï¼šè¾¹æ’­æ”¾è¾¹è¯†åˆ«æ­Œè¯å†…å®¹</li>
                <li><strong>æ—¶é—´æˆ³è®°å½•</strong>ï¼šç²¾ç¡®è®°å½•æ¯å¥æ­Œè¯çš„æ—¶é—´</li>
                <li><strong>LRCæ ¼å¼</strong>ï¼šç”Ÿæˆæ ‡å‡†æ­Œè¯æ–‡ä»¶æ ¼å¼</li>
                <li><strong>ç½®ä¿¡åº¦æ˜¾ç¤º</strong>ï¼šæ˜¾ç¤ºè¯†åˆ«å‡†ç¡®åº¦</li>
                <li><strong>ä¸€é”®ä¿å­˜</strong>ï¼šç›´æ¥ä¸‹è½½æ­Œè¯æ–‡ä»¶</li>
                <li><strong>æ™ºèƒ½åˆ†æ®µ</strong>ï¼šè‡ªåŠ¨åˆ†æ®µè¯†åˆ«æ­Œè¯å†…å®¹</li>
            </ul>
        </div>
    </div>

    <script>
        class VoiceLyricsDemo {
            constructor() {
                this.recognition = null;
                this.isRecognizing = false;
                this.startTime = null;
                this.lyricsData = [];
                this.initializeElements();
                this.initializeSpeechRecognition();
                this.bindEvents();
            }

            initializeElements() {
                this.startBtn = document.getElementById('startBtn');
                this.stopBtn = document.getElementById('stopBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.status = document.getElementById('status');
                this.progressBar = document.getElementById('progressBar');
                this.progressFill = document.getElementById('progressFill');
                this.stats = document.getElementById('stats');
                this.lyricsOutput = document.getElementById('lyricsOutput');
                this.downloadBtn = document.getElementById('downloadBtn');
                
                // ç»Ÿè®¡å…ƒç´ 
                this.segmentCount = document.getElementById('segmentCount');
                this.wordCount = document.getElementById('wordCount');
                this.confidence = document.getElementById('confidence');
                this.duration = document.getElementById('duration');
            }

            initializeSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    this.recognition.continuous = true;
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'zh-CN';
                    this.recognition.maxAlternatives = 1;
                    
                    this.recognition.onstart = this.onRecognitionStart.bind(this);
                    this.recognition.onresult = this.onRecognitionResult.bind(this);
                    this.recognition.onerror = this.onRecognitionError.bind(this);
                    this.recognition.onend = this.onRecognitionEnd.bind(this);
                    
                    this.showStatus('è¯­éŸ³è¯†åˆ«å·²åˆå§‹åŒ–', 'success');
                } else {
                    this.showStatus('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½', 'error');
                    this.startBtn.disabled = true;
                }
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.startRecognition());
                this.stopBtn.addEventListener('click', () => this.stopRecognition());
                this.clearBtn.addEventListener('click', () => this.clearResults());
                this.downloadBtn.addEventListener('click', () => this.downloadLyrics());
            }

            startRecognition() {
                if (!this.recognition) return;
                
                try {
                    this.lyricsData = [];
                    this.startTime = Date.now();
                    this.isRecognizing = true;
                    
                    this.startBtn.disabled = true;
                    this.stopBtn.disabled = false;
                    
                    this.showStatus('å¼€å§‹è¯­éŸ³è¯†åˆ«...', 'info');
                    this.showProgress(true);
                    
                    this.recognition.start();
                } catch (error) {
                    this.showStatus('å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
                    this.isRecognizing = false;
                    this.startBtn.disabled = false;
                    this.stopBtn.disabled = true;
                }
            }

            stopRecognition() {
                if (this.isRecognizing) {
                    this.recognition.stop();
                    this.isRecognizing = false;
                    this.startBtn.disabled = false;
                    this.stopBtn.disabled = true;
                    this.showStatus('è¯†åˆ«å·²åœæ­¢', 'info');
                    this.showProgress(false);
                }
            }

            clearResults() {
                this.lyricsData = [];
                this.lyricsOutput.style.display = 'none';
                this.stats.style.display = 'none';
                this.downloadBtn.style.display = 'none';
                this.showStatus('ç»“æœå·²æ¸…é™¤', 'info');
            }

            onRecognitionStart() {
                this.showStatus('ğŸ¤ æ­£åœ¨è¯†åˆ«ä¸­...', 'info');
                this.updateProgress(0);
            }

            onRecognitionResult(event) {
                const currentTime = Date.now();
                const elapsedTime = (currentTime - this.startTime) / 1000;
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const result = event.results[i];
                    const transcript = result[0].transcript.trim();
                    const confidence = result[0].confidence;
                    
                    if (result.isFinal && transcript.length > 0) {
                        this.lyricsData.push({
                            time: elapsedTime,
                            text: transcript,
                            confidence: confidence
                        });
                        
                        this.updateLyricsDisplay();
                        this.updateStats();
                        this.updateProgress((elapsedTime / 60) * 100); // å‡è®¾æœ€å¤š1åˆ†é’Ÿ
                    }
                }
            }

            onRecognitionError(event) {
                this.showStatus('è¯†åˆ«é”™è¯¯: ' + event.error, 'error');
                this.isRecognizing = false;
                this.startBtn.disabled = false;
                this.stopBtn.disabled = true;
                this.showProgress(false);
            }

            onRecognitionEnd() {
                if (this.isRecognizing) {
                    this.showStatus('è¯†åˆ«å®Œæˆ', 'success');
                    this.updateProgress(100);
                    this.downloadBtn.style.display = 'inline-block';
                }
                this.isRecognizing = false;
                this.startBtn.disabled = false;
                this.stopBtn.disabled = true;
            }

            updateLyricsDisplay() {
                let lrcContent = '[ti:è¯­éŸ³è¯†åˆ«æµ‹è¯•]\n';
                lrcContent += '[ar:æµ‹è¯•ç”¨æˆ·]\n';
                lrcContent += '[al:æ¼”ç¤ºä¸“è¾‘]\n';
                lrcContent += '[by:Web Speech API]\n';
                lrcContent += '[00:00.00]è¯­éŸ³è¯†åˆ«æµ‹è¯•\n\n';
                
                this.lyricsData.forEach(item => {
                    const timeTag = this.formatTime(item.time);
                    lrcContent += `[${timeTag}]${item.text}\n`;
                });
                
                this.lyricsOutput.textContent = lrcContent;
                this.lyricsOutput.style.display = 'block';
            }

            updateStats() {
                const totalWords = this.lyricsData.reduce((sum, item) => sum + item.text.length, 0);
                const avgConfidence = this.lyricsData.length > 0 
                    ? this.lyricsData.reduce((sum, item) => sum + item.confidence, 0) / this.lyricsData.length
                    : 0;
                const duration = this.startTime ? (Date.now() - this.startTime) / 1000 : 0;
                
                this.segmentCount.textContent = this.lyricsData.length;
                this.wordCount.textContent = totalWords;
                this.confidence.textContent = (avgConfidence * 100).toFixed(1) + '%';
                this.duration.textContent = duration.toFixed(1) + 's';
                
                this.stats.style.display = 'grid';
            }

            formatTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                const centisecs = Math.floor((seconds % 1) * 100);
                
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}.${centisecs.toString().padStart(2, '0')}`;
            }

            showStatus(message, type) {
                this.status.textContent = message;
                this.status.className = `status ${type}`;
                this.status.style.display = 'block';
            }

            showProgress(show) {
                this.progressBar.style.display = show ? 'block' : 'none';
            }

            updateProgress(percent) {
                this.progressFill.style.width = Math.min(100, Math.max(0, percent)) + '%';
            }

            downloadLyrics() {
                const lrcContent = this.lyricsOutput.textContent;
                const blob = new Blob([lrcContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'voice-recognition-lyrics.lrc';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showStatus('æ­Œè¯æ–‡ä»¶å·²ä¸‹è½½', 'success');
            }
        }

        // åˆå§‹åŒ–æ¼”ç¤º
        document.addEventListener('DOMContentLoaded', () => {
            new VoiceLyricsDemo();
        });
    </script>
</body>
</html>
