---
title: duyi笔记
author: Jihui
date: June 12, 2024
tags: [笔记, 浏览器, 渲染原理]
---

# 浏览器是如何渲染页面的?
当浏览器的网络线程收到HTML文档后, 会产生一个渲染任务. 并将其传递给渲染主线程的消息队列.
在事件循环机制的作用下, 渲染主线程取出消息队列中的渲染任务, 开始渲染流程.

整个渲染流程分为多个阶段, 分别是: HTML解析、样式计算、布局、分层、绘制、分块、光栅化、画
每个阶段都有明确的输入输出, 上一个阶段的输出会成为下一个阶段的输入.
这样, 整个渲染流程就形成了一套组织严密的生产流水线.

1. 解析HTML - Parse HTML
渲染的第一步是解析HTML.
解析过程中遇到CSS解析CSS, 遇到JS执行JS. 为了提高解析效率, 浏览器在开始解析前, 会启动一个预解析的线程, 率先下载HTML中的外部CSS文件和外部的JS文件.
如果主线程解析到link位置, 此时外部的CSS文件还没有下载解析好, 主线程不会等待, 继续解析后续的HTML. 这是因为下载和解析CSS的工作是在预解析线程中进行的. 这就是CSS不会阻塞HTML解析的根本原因.
如果主线程解析到script位置, 会停止解析HTML, 转而等待JS文件下载好,并将全局代码解析执行完成后, 才能继续解析HTML, 这是因为JS代码的执行过程可能会修改当前的DOM树, 所以DOM树的生成必须暂停. 这就是JS会阻塞HTML解析的根本原因.
第一步完成后, 会得到DOM树和CSSOM树, 浏览器的默认样式、内部样式、外部样式、行内样式均会包含在CSSOM树中.
